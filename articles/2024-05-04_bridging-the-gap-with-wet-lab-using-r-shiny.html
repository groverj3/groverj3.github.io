
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://groverj3.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://groverj3.github.io/theme/pygments/paraiso-dark.min.css">
  <link rel="stylesheet" type="text/css" href="https://groverj3.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://groverj3.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://groverj3.github.io/theme/font-awesome/css/solid.css">


    <link href="https://groverj3.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jeff Grover. Bioinformatics Scientist. Atom">





<meta name="author" content="Jeffrey Grover" />
<meta name="description" content="How do you communicate results of an analysis? What tools do you use? Scientists that work in the wet lab are accustomed to firing up excel or some instrument-specific software and working with their own data. For genomics or other types of experiments in biology that result in large datasets …" />
<meta name="keywords" content="R, shiny, app, RNAseq, bioinformatics, data-visualization">

<meta property="og:site_name" content="Jeff Grover. Bioinformatics Scientist."/>
<meta property="og:title" content="Bridging the Gap With Wet Lab Using R Shiny"/>
<meta property="og:description" content="How do you communicate results of an analysis? What tools do you use? Scientists that work in the wet lab are accustomed to firing up excel or some instrument-specific software and working with their own data. For genomics or other types of experiments in biology that result in large datasets …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://groverj3.github.io/articles/2024-05-04_bridging-the-gap-with-wet-lab-using-r-shiny.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2024-05-04 00:00:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://groverj3.github.io/author/jeffrey-grover.html">
<meta property="article:section" content="how-to"/>
<meta property="article:tag" content="R"/>
<meta property="article:tag" content="shiny"/>
<meta property="article:tag" content="app"/>
<meta property="article:tag" content="RNAseq"/>
<meta property="article:tag" content="bioinformatics"/>
<meta property="article:tag" content="data-visualization"/>
<meta property="og:image" content="/images/jeff.jpg">

  <title>Jeff Grover. Bioinformatics Scientist. &ndash; Bridging the Gap With Wet Lab Using R Shiny</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://groverj3.github.io">
        <img src="/images/jeff.jpg" alt="Jeffrey Grover" title="Jeffrey Grover">
      </a>
      <h1><a href="https://groverj3.github.io">Jeffrey Grover</a></h1>

<p>Senior Scientist - NGS & Bioinformatics @ <a href="https://www.entradatx.com/" target="_blank">Entrada Therapeutics</a></p>
      <nav>
        <ul class="list">

          <li><a href="/pages/about.html">About</a></li>
          <li><a href="/blog.html">Blog</a></li>
          <li><a href="/pages/cv.html">CV</a></li>
          <li><a href="/pages/projects.html">Projects</a></li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-envelope" href="mailto:jeffrey.w.grover@protonmail.com" target="_blank">
            <i class="fas fa-envelope">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/jeffreygrover/" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/groverj3" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://groverj3.github.io">    Home
</a>

      <a href="/pages/about.html">About</a>
      <a href="/blog.html">Blog</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://groverj3.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="bridging-the-gap-with-wet-lab-using-r-shiny">Bridging the Gap With Wet Lab Using R Shiny</h1>
    <p>
          Posted on Sat 04 May 2024 in <a href="https://groverj3.github.io/category/how-to.html">how-to</a>


    </p>
  </header>


  <div>
    <p>How do you communicate results of an analysis? What tools do you use?
Scientists that work in the wet lab are accustomed to firing up excel or some
instrument-specific software and working with their own data. For genomics
or other types of experiments in biology that result in large datasets this
approach is problematic and bioinformaticians have other tools to deal with our
data. Often, this involves working with large data in a programmatic way, and
the two languages in common usage are <a href="https://www.python.org/">Python</a> (usually
including its data science stack <a href="https://pandas.pydata.org/">pandas</a> et al.)
and <a href="https://www.r-project.org/">R</a> (usually including the <a href="https://www.tidyverse.org/">tidyverse</a>,
<a href="https://bioconductor.org/">bioconductor</a>, and friends).</p>
<p>There is obvious friction here. Bioinformatics scientists have a toolkit that
works great for us, but is foreign to a lot of the wet lab scientists around
us. How can we bridge this gap?</p>
<h2>A Common Example</h2>
<p>Your wet lab colleagues want to determine which genes are affected by treatment
with a compound, or test the effect of a mutation in a cell line/plant/mouse on
gene expression, etc. These situations are common applications for RNAseq.
Typically, they also involve a simple experimental design; a comparison of two
sample groups (treatment or mutant vs control).</p>
<p>The bioinformatician performs their analysis using a <a href="2024-04-26_on-bioinformatics-workflow-design.html">workflow</a>
resulting in fold changes, adjusted p-values, etc. in a table. They create a
visualization to help summarize the results to their colleagues, perhaps a
<a href="2024-04-21_making-volcano-plots-with-ggplot2.html">volcano plot</a>. Then ensues
a back and forth collaboration, resulting in requests to modify visualizations,
look at specific lists of genes, and more. While this process is rewarding, and can
result in a fruitful experiment, it can also be very inefficient. It can also
result in frustration on the part of both the bioinformatician and wet-lab
scientist. The bioinformatician because they want to be the most helpful, but
the wet lab scientist isn't experienced in exploring their data with the same
tools. The wet lab scientist wishes they could be more independent. This back
and forth can take a lot of time.</p>
<p>There are ways around this, graphical platforms that enable low/no-code ways to
analyze NGS or other big data. These are typically commercial products with a
lot of functionality, and despite being low/no-code there is still a learning
curve. Often the wet lab scientists want something simple, a way to explore an
already analyzed dataset supplied to them by their collaborating bioinformatics
scientist.</p>
<h2>The Shiny Framework</h2>
<p><a href="https://shiny.posit.co/">Shiny</a> is a framework for creating web applications
quickly, with minimal code required for an interactive app. Originally only for
R, it now supports Python as well. We'll be using it with R in this example.
There are other options (such as <a href="https://dash.plotly.com/">Dash</a>) so if you'd
rather use those, knock yourself out. I find Shiny's R syntax to be relatively
easy to work with, and very quick to learn.</p>
<p>What if we could create, in a matter of a few hours (depending on your
experience level), an application that runs in a web browser that enables our
wet lab friends to explore their analyzed datasets? It's not that hard. I
promise. If you have written a few functions and made some plots in R, Python,
or some other programming language then you know most of what you need to get
started.</p>
<h2>Our Goal</h2>
<p>For this example, we will create a Shiny application which generates volcano
plots from <a href="https://bioconductor.org/packages/release/bioc/html/DESeq2.html">DESeq2</a>
results. This example app will have the following features:</p>
<ol>
<li>Load results tables via browsing the local system.</li>
<li>Generate a volcano plot.</li>
<li>Display and allow searching through the results table.</li>
<li>Allow changing of differential expression thresholds.</li>
<li>Update the visualization and table according to differential expression
thresholds selected by users.</li>
</ol>
<p>We'll use the <a href="https://bioconductor.org/packages/release/data/experiment/html/pasilla.html">pasilla</a>
package from bioconductor for our test data, and the <a href="https://github.com/groverj3/genomics_visualizations/blob/master/volcano_plotteR.r">volcano plot code</a>
I've used as previous examples as a starting point.</p>
<h2>Set-up</h2>
<p>You'll need R installed. After that, to you'll need the some packages to follow
along. You can get them as follows. Open the R terminal and:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># If you don&#39;t have bioconductor</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">require</span><span class="p">(</span><span class="s">&quot;BiocManager&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
<span class="w">    </span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;BiocManager&quot;</span><span class="p">)</span>
<span class="n">BiocManager</span><span class="o">::</span><span class="nf">install</span><span class="p">(</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;3.19&quot;</span><span class="p">)</span>

<span class="c1"># BioCManager::install() will also install packages from CRAN so they&#39;re also in this list</span>
<span class="n">BiocManager</span><span class="o">::</span><span class="nf">install</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;DESeq2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;pasilla&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;apeglm&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1"># Needed for logfoldshrink in DESeq2</span>
<span class="w">    </span><span class="s">&quot;tidyverse&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;shiny&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;DT&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;DescTools&quot;</span>
<span class="p">))</span>

<span class="c1"># I like to use renv to manage project-specific libraries, this is optional</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;renv&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Note:</strong> I won't detail the use of <a href="https://github.com/groverj3/volcano_rnaseq_shiny_example">renv</a>
throughout this guide, but I like the package and you can and should read up on
the documentation. It's kind of like virtual environments for R. Especially
useful for a project like this or if you're working with multiple developers.</p>
<p>You'll now want to create a folder to work in, you'll likely want to put it on
github or another version control system. In your shell:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>~/Development/volcano_rnaseq_shiny_example
</code></pre></div>

<p>Then, go into that directory and create a subfolder called "shiny" and a single
.R file called "app.R".</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/Development/volcano_rnaseq_shiny_example
mkdir<span class="w"> </span>shiny
touch<span class="w"> </span>shiny/app.R
</code></pre></div>

<h2>Prepare the Differential Expression Data</h2>
<p>The test data for this app is supplied in the aforementioned github repo, but
for the sake of completeness, this is how it's generated.</p>
<p>First, load and reformat the pasilla data so it can be used for differential
expression in DESeq2. It's supplied as a counts matrix and metadata, but they
need some reformatting:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Load pasilla, and I always use the tidyverse</span>
<span class="nf">library</span><span class="p">(</span><span class="n">pasilla</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>

<span class="c1"># First load the counts table and then the metadata</span>
<span class="n">counts_table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">system.file</span><span class="p">(</span><span class="s">&quot;extdata/pasilla_gene_counts.tsv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pasilla&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">read_tsv</span><span class="p">()</span>

<span class="n">metadata_table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">system.file</span><span class="p">(</span><span class="s">&quot;extdata&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pasilla_sample_annotation.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pasilla&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">()</span>
</code></pre></div>

<p>In order for this to work with DESeq2 the column names for the samples (aside
from the gene IDs) in the <code>counts_table</code> must match row names (or a column that
can be converted to row names) in the <code>metadata_table</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">counts_table</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">()</span>
<span class="c1"># A tibble: 6 × 8</span>
<span class="w">  </span><span class="n">gene_id</span><span class="w"> </span><span class="n">untreated1</span><span class="w"> </span><span class="n">untreated2</span><span class="w"> </span><span class="n">untreated3</span><span class="w"> </span><span class="n">untreated4</span><span class="w"> </span><span class="n">treated1</span><span class="w"> </span><span class="n">treated2</span><span class="w"> </span><span class="n">treated3</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">        </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span><span class="w">      </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span><span class="w">      </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span><span class="w">      </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span><span class="w">    </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span><span class="w">    </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span><span class="w">    </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>
<span class="m">1</span><span class="w"> </span><span class="n">FBgn00</span>…<span class="w">          </span><span class="m">0</span><span class="w">          </span><span class="m">0</span><span class="w">          </span><span class="m">0</span><span class="w">          </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">        </span><span class="m">1</span>
<span class="m">2</span><span class="w"> </span><span class="n">FBgn00</span>…<span class="w">         </span><span class="m">92</span><span class="w">        </span><span class="m">161</span><span class="w">         </span><span class="m">76</span><span class="w">         </span><span class="m">70</span><span class="w">      </span><span class="m">140</span><span class="w">       </span><span class="m">88</span><span class="w">       </span><span class="m">70</span>
<span class="m">3</span><span class="w"> </span><span class="n">FBgn00</span>…<span class="w">          </span><span class="m">5</span><span class="w">          </span><span class="m">1</span><span class="w">          </span><span class="m">0</span><span class="w">          </span><span class="m">0</span><span class="w">        </span><span class="m">4</span><span class="w">        </span><span class="m">0</span><span class="w">        </span><span class="m">0</span>
<span class="m">4</span><span class="w"> </span><span class="n">FBgn00</span>…<span class="w">          </span><span class="m">0</span><span class="w">          </span><span class="m">2</span><span class="w">          </span><span class="m">1</span><span class="w">          </span><span class="m">2</span><span class="w">        </span><span class="m">1</span><span class="w">        </span><span class="m">0</span><span class="w">        </span><span class="m">0</span>
<span class="m">5</span><span class="w"> </span><span class="n">FBgn00</span>…<span class="w">       </span><span class="m">4664</span><span class="w">       </span><span class="m">8714</span><span class="w">       </span><span class="m">3564</span><span class="w">       </span><span class="m">3150</span><span class="w">     </span><span class="m">6205</span><span class="w">     </span><span class="m">3072</span><span class="w">     </span><span class="m">3334</span>
<span class="m">6</span><span class="w"> </span><span class="n">FBgn00</span>…<span class="w">        </span><span class="m">583</span><span class="w">        </span><span class="m">761</span><span class="w">        </span><span class="m">245</span><span class="w">        </span><span class="m">310</span><span class="w">      </span><span class="m">722</span><span class="w">      </span><span class="m">299</span><span class="w">      </span><span class="m">308</span>

<span class="n">metadata_table</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">()</span>
<span class="c1"># A tibble: 6 × 6</span>
<span class="w">  </span><span class="n">file</span><span class="w">    </span><span class="n">condition</span><span class="w"> </span><span class="n">type</span><span class="w">  </span><span class="n">`number of lanes`</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">read</span>…¹<span class="w"> </span><span class="n">`exon counts`</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">   </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">     </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">             </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">                          </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>
<span class="m">1</span><span class="w"> </span><span class="n">treate</span>…<span class="w"> </span><span class="n">treated</span><span class="w">   </span><span class="n">sing</span>…<span class="w">                 </span><span class="m">5</span><span class="w"> </span><span class="m">35158667</span><span class="w">                    </span><span class="m">15679615</span>
<span class="m">2</span><span class="w"> </span><span class="n">treate</span>…<span class="w"> </span><span class="n">treated</span><span class="w">   </span><span class="n">pair</span>…<span class="w">                 </span><span class="m">2</span><span class="w"> </span><span class="m">12242535</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="w">               </span><span class="m">15620018</span>
<span class="m">3</span><span class="w"> </span><span class="n">treate</span>…<span class="w"> </span><span class="n">treated</span><span class="w">   </span><span class="n">pair</span>…<span class="w">                 </span><span class="m">2</span><span class="w"> </span><span class="m">12443664</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="w">               </span><span class="m">12733865</span>
<span class="m">4</span><span class="w"> </span><span class="n">untrea</span>…<span class="w"> </span><span class="n">untreated</span><span class="w"> </span><span class="n">sing</span>…<span class="w">                 </span><span class="m">2</span><span class="w"> </span><span class="m">17812866</span><span class="w">                    </span><span class="m">14924838</span>
<span class="m">5</span><span class="w"> </span><span class="n">untrea</span>…<span class="w"> </span><span class="n">untreated</span><span class="w"> </span><span class="n">sing</span>…<span class="w">                 </span><span class="m">6</span><span class="w"> </span><span class="m">34284521</span><span class="w">                    </span><span class="m">20764558</span>
<span class="m">6</span><span class="w"> </span><span class="n">untrea</span>…<span class="w"> </span><span class="n">untreated</span><span class="w"> </span><span class="n">pair</span>…<span class="w">                 </span><span class="m">2</span><span class="w"> </span><span class="m">10542625</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="w">               </span><span class="m">10283129</span>
<span class="c1"># ℹ abbreviated name: ¹​`total number of reads`</span>

<span class="n">metadata_table</span><span class="o">$</span><span class="n">file</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s">&quot;treated1fb&quot;</span><span class="w">   </span><span class="s">&quot;treated2fb&quot;</span><span class="w">   </span><span class="s">&quot;treated3fb&quot;</span><span class="w">   </span><span class="s">&quot;untreated1fb&quot;</span><span class="w"> </span><span class="s">&quot;untreated2fb&quot;</span>
<span class="p">[</span><span class="m">6</span><span class="p">]</span><span class="w"> </span><span class="s">&quot;untreated3fb&quot;</span><span class="w"> </span><span class="s">&quot;untreated4fb&quot;</span>

<span class="n">metadata_table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">metadata_table</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">mutate</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str_remove</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fb&quot;</span><span class="p">))</span>

<span class="n">metadata_table</span>
<span class="c1"># A tibble: 7 × 2</span>
<span class="w">  </span><span class="n">file</span><span class="w">       </span><span class="n">condition</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">      </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">    </span>
<span class="m">1</span><span class="w"> </span><span class="n">treated1</span><span class="w">   </span><span class="n">treated</span><span class="w">  </span>
<span class="m">2</span><span class="w"> </span><span class="n">treated2</span><span class="w">   </span><span class="n">treated</span><span class="w">  </span>
<span class="m">3</span><span class="w"> </span><span class="n">treated3</span><span class="w">   </span><span class="n">treated</span><span class="w">  </span>
<span class="m">4</span><span class="w"> </span><span class="n">untreated1</span><span class="w"> </span><span class="n">untreated</span>
<span class="m">5</span><span class="w"> </span><span class="n">untreated2</span><span class="w"> </span><span class="n">untreated</span>
<span class="m">6</span><span class="w"> </span><span class="n">untreated3</span><span class="w"> </span><span class="n">untreated</span>
<span class="m">7</span><span class="w"> </span><span class="n">untreated4</span><span class="w"> </span><span class="n">untreated</span>

<span class="c1"># Order the samples correctly</span>
<span class="n">counts_table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counts_table</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">gene_id</span><span class="p">,</span><span class="w"> </span><span class="n">metadata_table</span><span class="o">$</span><span class="n">file</span><span class="p">)</span>
</code></pre></div>

<p>Welcome to the wild and wonderful world of data cleaning. How's it feel to be a
computer janitor? I still do this kind of stuff more than any of the fancy analysis
methods I've learned. Data are messy.</p>
<p>Now, you can generate some results based on treated vs untreated conditions:</p>
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">DESeq2</span><span class="p">)</span>

<span class="n">dds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">DESeqDataSetFromMatrix</span><span class="p">(</span>
<span class="w">    </span><span class="n">countData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">column_to_rownames</span><span class="p">(</span><span class="n">counts_table</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gene_id&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">colData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">column_to_rownames</span><span class="p">(</span><span class="n">metadata_table</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;file&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">condition</span>
<span class="p">)</span>

<span class="n">dds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">DESeq</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span>
<span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lfcShrink</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span><span class="w"> </span><span class="n">coef</span><span class="o">=</span><span class="s">&quot;condition_treated_vs_untreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;apeglm&quot;</span><span class="p">)</span>
<span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">as.data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">rownames_to_column</span><span class="p">(</span><span class="s">&quot;gene_id&quot;</span><span class="p">)</span>

<span class="n">results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">()</span>
<span class="w">      </span><span class="n">gene_id</span><span class="w">     </span><span class="n">baseMean</span><span class="w"> </span><span class="n">log2FoldChange</span><span class="w">     </span><span class="n">lfcSE</span><span class="w">    </span><span class="n">pvalue</span><span class="w">      </span><span class="n">padj</span>
<span class="m">1</span><span class="w"> </span><span class="n">FBgn0000003</span><span class="w">    </span><span class="m">0.1715687</span><span class="w">    </span><span class="m">0.006979656</span><span class="w"> </span><span class="m">0.2057852</span><span class="w"> </span><span class="m">0.7874583</span><span class="w">        </span><span class="kc">NA</span>
<span class="m">2</span><span class="w"> </span><span class="n">FBgn0000008</span><span class="w">   </span><span class="m">95.1440790</span><span class="w">    </span><span class="m">0.001115354</span><span class="w"> </span><span class="m">0.1517065</span><span class="w"> </span><span class="m">0.9923316</span><span class="w"> </span><span class="m">0.9969282</span>
<span class="m">3</span><span class="w"> </span><span class="n">FBgn0000014</span><span class="w">    </span><span class="m">1.0565722</span><span class="w">   </span><span class="m">-0.004634136</span><span class="w"> </span><span class="m">0.2048948</span><span class="w"> </span><span class="m">0.8181371</span><span class="w">        </span><span class="kc">NA</span>
<span class="m">4</span><span class="w"> </span><span class="n">FBgn0000015</span><span class="w">    </span><span class="m">0.8467233</span><span class="w">   </span><span class="m">-0.018148393</span><span class="w"> </span><span class="m">0.2061771</span><span class="w"> </span><span class="m">0.3714205</span><span class="w">        </span><span class="kc">NA</span>
<span class="m">5</span><span class="w"> </span><span class="n">FBgn0000017</span><span class="w"> </span><span class="m">4352.5928988</span><span class="w">   </span><span class="m">-0.191126743</span><span class="w"> </span><span class="m">0.1201758</span><span class="w"> </span><span class="m">0.0568330</span><span class="w"> </span><span class="m">0.2823626</span>
<span class="m">6</span><span class="w"> </span><span class="n">FBgn0000018</span><span class="w">  </span><span class="m">418.6149305</span><span class="w">   </span><span class="m">-0.070043056</span><span class="w"> </span><span class="m">0.1236900</span><span class="w"> </span><span class="m">0.4797142</span><span class="w"> </span><span class="m">0.8239063</span>

<span class="n">results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">write_csv</span><span class="p">(</span><span class="s">&quot;pasilla_results.csv&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Now you can see how many differentially expressed genes (at the BH-adjusted p &lt; 0.1):</p>
<div class="highlight"><pre><span></span><code><span class="n">results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">padj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">nrow</span><span class="p">()</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="m">1061</span>
</code></pre></div>

<h2>Let's Build the Shiny App</h2>
<p>For the ease of following along, I'm putting this shiny app up on my github:
<a href="https://github.com/groverj3/volcano_rnaseq_shiny_example">volcano_rnaseq_shiny_example</a>.
You can find a working example there.</p>
<p>To create it yourself, open the <code>app.R</code> we created earlier in your favorite
text/code editor and add the following:</p>
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">bslib</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">DescTools</span><span class="p">)</span>


<span class="c1"># Volcano plot code based from https://github.com/groverj3/genomics_visualizations/blob/master/volcano_plotteR.r</span>
<span class="n">volcplot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">padj_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">fc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">plot_title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;Volcano Plot&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">plot_subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1"># Set the fold-change thresholds</span>
<span class="w">  </span><span class="n">neg_log2fc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">-</span><span class="nf">log2</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>
<span class="w">  </span><span class="n">pos_log2fc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">log2</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Make a dataset for plotting, add the status as a new column</span>
<span class="w">  </span><span class="n">plot_ready_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">mutate_at</span><span class="p">(</span><span class="s">&#39;padj&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="nf">replace</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">.x</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">mutate_at</span><span class="p">(</span><span class="s">&quot;padj&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="nf">replace</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">.x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">.Machine</span><span class="o">$</span><span class="n">double.xmin</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># When p values are zero, they&#39;re actually below the lowest value R can display</span>
<span class="w">    </span><span class="nf">mutate_at</span><span class="p">(</span><span class="s">&#39;log2FoldChange&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="nf">replace</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">.x</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">mutate</span><span class="p">(</span>
<span class="w">      </span><span class="n">log2fc_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">pos_log2fc</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">padj</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">padj_threshold</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;up&#39;</span><span class="p">,</span>
<span class="w">                         </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">neg_log2fc</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">padj</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">padj_threshold</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;down&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;ns&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Get the number of up, down, and unchanged genes</span>
<span class="w">  </span><span class="n">up_genes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_ready_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">log2fc_threshold</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;up&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">nrow</span><span class="p">()</span>
<span class="w">  </span><span class="n">down_genes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_ready_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">log2fc_threshold</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;down&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">nrow</span><span class="p">()</span>
<span class="w">  </span><span class="n">unchanged_genes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_ready_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">log2fc_threshold</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;ns&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">nrow</span><span class="p">()</span>

<span class="w">  </span><span class="c1"># Make the labels for the legend</span>
<span class="w">  </span><span class="n">legend_labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span>
<span class="w">      </span><span class="nf">str_c</span><span class="p">(</span><span class="s">&#39;Up: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">up_genes</span><span class="p">),</span>
<span class="w">      </span><span class="nf">str_c</span><span class="p">(</span><span class="s">&#39;NS: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">unchanged_genes</span><span class="p">),</span>
<span class="w">      </span><span class="nf">str_c</span><span class="p">(</span><span class="s">&#39;Down: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">down_genes</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Set the x axis limits, rounded to the next even number</span>
<span class="w">  </span><span class="n">x_axis_limits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DescTools</span><span class="o">::</span><span class="nf">RoundTo</span><span class="p">(</span>
<span class="w">    </span><span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">plot_ready_data</span><span class="o">$</span><span class="n">log2FoldChange</span><span class="p">)),</span>
<span class="w">    </span><span class="m">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">ceiling</span>
<span class="w">  </span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Set the plot colors</span>
<span class="w">  </span><span class="n">plot_colors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span>
<span class="w">      </span><span class="s">&#39;up&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;firebrick1&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&#39;ns&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;gray&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&#39;down&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;dodgerblue1&#39;</span>
<span class="w">  </span><span class="p">)</span>


<span class="w">  </span><span class="c1"># Make the plot, these options are a reasonable starting point</span>
<span class="w">  </span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">plot_ready_data</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_point</span><span class="p">(</span>
<span class="w">      </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span>
<span class="w">      </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">aes</span><span class="p">(</span>
<span class="w">      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log2FoldChange</span><span class="p">,</span>
<span class="w">      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">log10</span><span class="p">(</span><span class="n">padj</span><span class="p">),</span>
<span class="w">      </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log2fc_threshold</span><span class="p">,</span>
<span class="w">      </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gene_id</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_vline</span><span class="p">(</span>
<span class="w">      </span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">neg_log2fc</span><span class="p">,</span><span class="w"> </span><span class="n">pos_log2fc</span><span class="p">),</span>
<span class="w">      </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;dashed&#39;</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_hline</span><span class="p">(</span>
<span class="w">      </span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">log10</span><span class="p">(</span><span class="n">padj_threshold</span><span class="p">),</span>
<span class="w">      </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;dashed&#39;</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">scale_x_continuous</span><span class="p">(</span>
<span class="w">      </span><span class="s">&#39;log2(FC)&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="n">x_axis_limits</span><span class="p">,</span><span class="w"> </span><span class="n">x_axis_limits</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">scale_color_manual</span><span class="p">(</span>
<span class="w">      </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot_colors</span><span class="p">,</span>
<span class="w">      </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">legend_labels</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span>
<span class="w">      </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str_c</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-fold, padj ≤&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">padj_threshold</span><span class="p">),</span>
<span class="w">      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot_title</span><span class="p">,</span>
<span class="w">      </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot_subtitle</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">      </span><span class="n">aspect.ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">      </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;black&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="n">legend.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">      </span><span class="n">legend.box.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w">  </span><span class="c1"># Reduces dead area around legend</span>
<span class="w">      </span><span class="n">legend.spacing.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;cm&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="n">plot</span>
<span class="p">}</span>


<span class="c1"># Define UI</span>
<span class="n">ui</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">page_sidebar</span><span class="p">(</span>
<span class="w">  </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Volcano PlotteR&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">sidebar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sidebar</span><span class="p">(</span>
<span class="w">    </span><span class="nf">fileInput</span><span class="p">(</span><span class="s">&quot;deseq2_results&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DESeq2 Results Table&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="nf">numericInput</span><span class="p">(</span><span class="s">&quot;foldchange_threshold&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fold Change Threshold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span>
<span class="w">    </span><span class="nf">numericInput</span><span class="p">(</span><span class="s">&quot;padj_threshold&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adjusted p-value Threshold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">),</span>
<span class="w">    </span><span class="nf">textInput</span><span class="p">(</span><span class="s">&quot;plot_title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Plot Title&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Volcano Plot&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="nf">textInput</span><span class="p">(</span><span class="s">&quot;plot_subtitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Plot Subtitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">),</span>
<span class="w">  </span><span class="p">),</span>
<span class="w">  </span><span class="nf">card</span><span class="p">(</span>
<span class="w">    </span><span class="nf">plotOutput</span><span class="p">(</span><span class="s">&quot;volcano_plot&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">min_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">580</span><span class="w">  </span><span class="c1"># Ensures you don&#39;t have to scroll within this card</span>
<span class="w">  </span><span class="p">),</span>
<span class="w">  </span><span class="nf">DTOutput</span><span class="p">(</span><span class="s">&quot;deseq2_table&quot;</span><span class="p">)</span>
<span class="p">)</span>


<span class="c1"># Server function</span>
<span class="n">server</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">options</span><span class="p">(</span><span class="n">shiny.maxRequestSize</span><span class="o">=</span><span class="m">30</span><span class="o">*</span><span class="m">1024</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="w">  </span><span class="n">deseq2_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">reactive</span><span class="p">({</span>
<span class="w">    </span><span class="nf">req</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">deseq2_results</span><span class="p">)</span>
<span class="w">    </span><span class="nf">read_csv</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">deseq2_results</span><span class="o">$</span><span class="n">datapath</span><span class="p">)</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="n">deseq2_results_filtered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">reactive</span><span class="p">({</span>
<span class="w">    </span><span class="nf">req</span><span class="p">(</span><span class="n">deseq2_results</span><span class="p">)</span>
<span class="w">    </span><span class="nf">deseq2_results</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">      </span><span class="nf">filter</span><span class="p">(</span><span class="m">2</span><span class="o">^</span><span class="nf">abs</span><span class="p">(</span><span class="n">log2FoldChange</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">foldchange_threshold</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">padj</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">padj_threshold</span><span class="p">)</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="n">output</span><span class="o">$</span><span class="n">deseq2_table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">renderDT</span><span class="p">(</span>
<span class="w">    </span><span class="nf">deseq2_results_filtered</span><span class="p">()</span>
<span class="w">  </span><span class="p">)</span>

<span class="w">  </span><span class="n">output</span><span class="o">$</span><span class="n">volcano_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">renderPlot</span><span class="p">({</span>
<span class="w">    </span><span class="nf">req</span><span class="p">(</span><span class="n">deseq2_results</span><span class="p">)</span>
<span class="w">    </span><span class="nf">deseq2_results</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">      </span><span class="nf">volcplot</span><span class="p">(</span>
<span class="w">        </span><span class="n">padj_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">padj_threshold</span><span class="p">,</span>
<span class="w">        </span><span class="n">fc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">foldchange_threshold</span><span class="p">,</span>
<span class="w">        </span><span class="n">plot_title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">plot_title</span><span class="p">,</span>
<span class="w">        </span><span class="n">plot_subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">plot_subtitle</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">550</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Run the application</span>
<span class="nf">shinyApp</span><span class="p">(</span><span class="n">ui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ui</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">)</span>
</code></pre></div>

<p>There's a bit to unpack here. But for now, just run it by entering the
<code>volcano_rnaseq_shiny_example</code> project directory, starting the R interpreter
with <code>R</code>, and running:</p>
<div class="highlight"><pre><span></span><code><span class="n">shiny</span><span class="o">::</span><span class="nf">runApp</span><span class="p">(</span><span class="s">&quot;shiny&quot;</span><span class="p">)</span>
</code></pre></div>

<p>"shiny" within runApp matches the name of the subfolder containing our <code>app.R</code>.
If everything works as expected (fingers crossed!) you'll be presented with
something like the following in your R terminal:</p>
<div class="highlight"><pre><span></span><code>Listening on http://127.0.0.1:3698
</code></pre></div>

<p>If you navigate to the IP address and port in your favorite browser you should
see the fruits of your labors. After clicking the browse button you can load
the <code>pasilla_results.csv</code> you created earlier:</p>
<p><center>
<img src="https://raw.githubusercontent.com/groverj3/volcano_rnaseq_shiny_example/main/images/volcano_plotteR_1.png" alt="Your App is Served">
</center></p>
<p>That looks great! Now try changing the controls on the left. You'll see that the
plot and table react in real time!</p>
<p><center>
<img src="https://raw.githubusercontent.com/groverj3/volcano_rnaseq_shiny_example/main/images/volcano_plotteR_2.png" alt="It's reactive!">
</center></p>
<h2>Explanation</h2>
<p>If you ignore the volcano plot code, which is mostly the same (with some
changes and simplifications) as my explanation in a <a href="2024-04-21_making-volcano-plots-with-ggplot2.html">previous post</a>
you're left with only ~50 lines of code. That's really not much to get an
interactive web app.</p>
<p>The main logic of the app is broken up into two parts, the ui (defined by
layouts and content) and the <code>server()</code> function. The inputs and outputs in the
server function map to the names of the inputs and outputs from the ui. You can
have different types of outputs (plots, tables, etc.) in sections of the UI. In
this simple example we use the use <code>library(DT)</code> and the <code>DTOutput()</code> function
as a way to display dataframes that uses the javascript DataTables library as a
backend. Likewise our volcano plot code uses ggplot2 and the <code>plotOutput()</code>
function displays it. At the end of the code, we run <code>shinyApp()</code> with our ui
and server to make it all happen.</p>
<p>There are a few other things of note going on here. We've wrapped filtering of
our results table and plotting in <code>reactive()</code>. This does exactly what you
think, it makes the plot and data table react to changes in the input data. So
when you change the data that was loaded in, or any of the controls that map to
filtering criteria, etc. the elements are regenerated. The <code>req()</code> function in
there identifies that the input dataset is the element to which the output
reacts. Hopefully that makes sense. For a simple example, I think that
explanation suffices.</p>
<p>All of these packages and functions have great documentation that goes far
beyond what I've written here, so I recommend reading it. You can add a lot
more functionality without too much trouble, this is just a simple example.</p>
<h2>What Can You <strong>DO</strong> With This?</h2>
<p>Imagine you're in a meeting and you're having that back and forth with the wet
lab scientists I talked about earlier. Now, you can pull out your shiny app
and use that as a tool to filter data, generate visualizations, and save the
output on the fly. Even better, if you get really ambitious you can containerize
it, serve it on your LAN, and let anyone use it!</p>
<p>I suspect the bench scientists will be happy because they can filter, visualize,
and do whatever else you've built for them. You'll be happy because your
meetings can be more productive and your colleagues can generate more insights
on their own and bring those to you for in-depth analysis.</p>
<p>The more I think about what the optimal split of duties for a genomics project
should be, the more I think we should be developing simple tools like this.
Small interactive apps like this allow bioinformatics staff to focus on solving
hard problems, making sure data is processed consistently, figuring out how to
apply novel methods to lage datasets, etc. The other stakeholders who help to
generate the data can be empowered to explore that data without the burden of
knowing how to process it from raw files, but still get to have an active role
in generating insights.</p>
<p>Shiny and similar frameworks have relatively easy syntax to learn when getting
started if you're already familiar with R or python. While there are certainly
commercial products that have functionality far surpassing these small apps, if
you're looking for a simple tool to help bridge the gap between wet and dry lab
scientists this may fit the bill at $0, aside from your labor :).</p>
<h2>Reference</h2>
<p>Huber W, Reyes A (2024). pasilla: Data package with per-exon and per-gene read
counts of RNA-seq samples of Pasilla knock-down by Brooks et al., Genome
Research 2011.. R package version 1.32.0. </p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://groverj3.github.io/tag/r.html">R</a>
      <a href="https://groverj3.github.io/tag/shiny.html">shiny</a>
      <a href="https://groverj3.github.io/tag/app.html">app</a>
      <a href="https://groverj3.github.io/tag/rnaseq.html">RNAseq</a>
      <a href="https://groverj3.github.io/tag/bioinformatics.html">bioinformatics</a>
      <a href="https://groverj3.github.io/tag/data-visualization.html">data-visualization</a>
    </p>
  </div>





</article>

    <footer>
<p>
  &copy;  2019 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jeff Grover. Bioinformatics Scientist. ",
  "url" : "https://groverj3.github.io",
  "image": "/images/jeff.jpg",
  "description": ""
}
</script>

</body>
</html>